<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
	<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
	<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
	<title>用户管理</title>
</head>
<style>
        #DataTables_Table_0_paginate {
            float: right;
            padding-top: 50px;
            text-align: right;
        }

        .paginate_button {
            background: #fff;
            color: rgb(0, 0, 0);
            border: 1px solid #ccc;
            cursor: pointer;
            display: inline-block;
            margin-left: 2px;
            text-align: center;
            text-decoration: none;
            height: 26px;
            line-height: 26px;
            margin: 0 0 6px 6px;
            padding: 0 10px;
            font-size: 14px;

        }

        .paginate_button:hover {
            background: #5a98de;
            color: #fff;
            text-decoration: none;
        }

        .pageGGshuru {
            width: 26px;
            height: 24px;
            border: 1px solid #ededed;
            line-height: 24px;
            text-align: center;
            margin: 0px 4px;
        }
    </style>

<body>
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 用户中心 <span class="c-gray en">&gt;</span>
		用户管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);"
		 title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a></nav>
	<div class="page-container">
		<div class="text-c">
			<input type="text" class="input-text" style="width:250px" placeholder="输入会员名称、电话、邮箱" id="souuser" name="">
			<button type="submit" class="btn btn-success radius" id="" name="" onclick="jumpPage('start')"><i class="Hui-iconfont">&#xe665;</i>
				搜用户</button>
		</div>
		<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="r">共有数据：<strong id="totalM"></strong> 条</span> </div>
		<div class="mt-20">
			<table class="table table-border table-bordered table-hover table-bg table-sort">
				<thead>
					<tr class="text-c">
						<th width="25"><input type="checkbox" name="" value=""></th>
						<th width="80">ID</th>
						<th width="100">用户名</th>
						<th width="40">性别</th>
						<th width="90">手机</th>
						<th width="150">邮箱</th>
						<th width="">地址</th>
						<th width="130">加入时间</th>
						<th width="70">状态</th>
						<th width="100">操作</th>
					</tr>
				</thead>
				<tbody id="tbody">

				</tbody>
            </table>
            <label>每页显示
                    <select name="DataTables_Table_0_length" onchange="change_pagesize()" aria-controls="DataTables_Table_0"
                        style="width:50px;margin-top: 50px" id="change_pagesize" class="select">
                        <option value="2">2</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                    </select> 条
                </label>/<span>共 <span id="pages"></span> 页</span>
                <div class="dataTables_paginate paging_simple_numbers" id="DataTables_Table_0_paginate">
                    <input type="button" onclick="jumpPage('start')" class="paginate_button next disabled" value="首页" />
                    <a class="paginate_button previous disabled" onclick="jumpPage('prev')" aria-controls="DataTables_Table_0"
                        data-dt-idx="0" tabindex="0" id="DataTables_Table_0_previous">上一页</a>
                    <span>
                        <a class="paginate_button current" id="show_page" aria-controls="DataTables_Table_0" data-dt-idx="1"
                            tabindex="0">1</a>
                    </span>
                    <a class="paginate_button next disabled" onclick="jumpPage('next')" aria-controls="DataTables_Table_0"
                        data-dt-idx="2" tabindex="0" id="DataTables_Table_0_next">下一页</a>
                    <strong>到第</strong>
                    <input type="text" class="pageGGshuru" id='jumppage' value="1">
                    <strong>页</strong>
                    <input type="button" onclick="jumpPage('jump')" class="paginate_button next disabled" value="跳转" />
                    <input type="button" onclick="jumpPage('end')" class="paginate_button next disabled" value="尾页" />
                </div>
		</div>
	</div>
	<!--_footer 作为公共模版分离出去-->
	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
	<!--/_footer 作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
	<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
	<script type="text/javascript">
		// $(function(){
		// 	$('.table-sort').dataTable({
		// 		"aaSorting": [[ 1, "desc" ]],//默认第几个排序
		// 		"bStateSave": true,//状态保存
		// 		"aoColumnDefs": [
		// 		  //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
		// 		  {"orderable":false,"aTargets":[0,8,9]}// 制定列不参与排序
		// 		]
		// 	});

		// });
		/*用户-添加*/
		function member_add(title, url, w, h) {
			layer_show(title, url, w, h);
		}
		/*用户-查看*/
		function member_show(title, url, id, w, h) {
			layer_show(title, url, w, h);
		}
		/*用户-停用*/
		function member_stop(obj, id) {
			layer.confirm('确认要停用吗？', function (index) {
				$.ajax({
					type: 'POST',
					url: '',
					dataType: 'json',
					success: function (data) {
						$(obj).parents("tr").find(".td-manage").prepend(
							'<a style="text-decoration:none" onClick="member_start(this,id)" href="javascript:;" title="启用"><i class="Hui-iconfont">&#xe6e1;</i></a>'
						);
						$(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已停用</span>');
						$(obj).remove();
						layer.msg('已停用!', {
							icon: 5,
							time: 1000
						});
					},
					error: function (data) {
						console.log(data.msg);
					},
				});
			});
		}

		/*用户-启用*/
		function member_start(obj, id) {
			layer.confirm('确认要启用吗？', function (index) {
				$.ajax({
					type: 'POST',
					url: '',
					dataType: 'json',
					success: function (data) {
						$(obj).parents("tr").find(".td-manage").prepend(
							'<a style="text-decoration:none" onClick="member_stop(this,id)" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a>'
						);
						$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已启用</span>');
						$(obj).remove();
						layer.msg('已启用!', {
							icon: 6,
							time: 1000
						});
					},
					error: function (data) {
						console.log(data.msg);
					},
				});
			});
		}


		let rootpath = localStorage.getItem('ip');
        let pageSize = 2
        let page = 1
        let count = 0 //数据总数
        let nowPage = 1 //当前页

        function change_pagesize() {
            pageSize = $('#change_pagesize').val()
            jumpPage('start')
        }

        function jumpPage(type) {
            switch (type) {
                case 'start':
                    // 首页
                    page = 1
                    break;
                case 'end':
                    // 尾页
                    page = Math.ceil(count / pageSize)
                    break;
                case 'next':
                    page = nowPage + 1
                    if (page > Math.ceil(count / pageSize)) {
                        page = Math.ceil(count / pageSize)
                        alert('已达到最后一页')
                    }
                    break;
                case 'prev':
                    page = nowPage - 1
                    if (page <= 0) {
                        page = 1
                        alert('已达到第一页')
                    }
                    break;
                case 'jump':
                    page = $('#jumppage').val()
                    if (page<=0) {
                        page = 1
                        $('#jumppage').val(1)
                        alert('页码错误，已跳到第一页')
                    }else if(page > Math.ceil(count / pageSize)){
                        page = Math.ceil(count / pageSize)
                        $('#jumppage').val(page)
                        alert('页码超出，已跳到最后一页')
                    }else{
                        page = page
                    }
                    break;
            }
            $('#show_page').html(page)
            sounima()
        }


        function sounima() {
            let keyword = $('#souuser').val();
            $.ajax({
                async: true,
                url: localStorage.getItem('ip')+"/admin/user/getUserByKw",
                type: 'post', //请求的方式
                data: {
                    keyword,
                    page,
                    pageSize
                }, //请求的数据
                success: function (res) { //请求成功后返回的数据会封装在回调函数的第一个参数中
                    //通过backdata来获取所需要的数据
                    if (res.err !== 0) {
                        return false
                    }
                    // console.log(res)
                    nowPage = page //数据请求成功后更新当前页
                    count = res.data.result.count
                    $('#totalM').html(count)
                    $('#pages').html(Math.ceil(count / pageSize))
                    // 获取分页过之后的数据信息
                    getUserByKw(res.data.data)
                    
                },
                error: function (err) { //响应不成功时返回的函数
                    console.log('请求失败！')
                    console.log(err);

                },
                dataType: 'json' //设置返回的数据类型
            })
        }
        // 初始化首页数据
        jumpPage('start')
		function getUserByKw(data) {
			// console.log(backdata);



			var snackL = "";


			for (let index = 0; index < data.length; index++) {
				// var msg = 

				snackL +=
					`<tr class="text-c">
				<td><input type="checkbox" value="1" name=""></td>
				<td>${index+1}</td>
				<td>${data[index].name}</td>
				<td></td>
				<td></td>
				<td></td>
				<td class="text-l"></td>
				<td></td>
				<td class="td-status"><span class="label label-success radius">已启用</span></td>
				<td class="td-manage"><a style="text-decoration:none" onClick="member_stop(this,'10001')" href="javascript:;" title="停用"><i class="Hui-iconfont">&#xe631;</i></a> </td>
			</tr>`
			}

			// var dataContent=document.getElementById('dataContent');
			$('#tbody').html(snackL)
		}
	</script>
</body>

</html>